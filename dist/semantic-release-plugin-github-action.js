"use strict";var h=require("execa");const o=async(e,s=[])=>await h.execa("git",[e,...s]),w=(e,{allowEmpty:s=!1,keyid:t,sign:n=!1}={})=>{const c=[];if(n){const a="-S",i=typeof t=="string"&&t!==""?`${a}${t}`:a;c.push(i)}return s&&c.push("--allow-empty"),[...c,"-m",`${e}`]},$=async(e,s={})=>{const t=w(e,s);return await o("commit",t)},y=(e,{get:s=!1,list:t=!1,unset:n=!1,scope:c="local",value:a}={})=>{const i=[`--${c}`];return a!=null?i.push(`${e}`,`${a.toString()}`):s?i.push("--get",`${e}`):n?i.push("--unset",`${e}`):t&&i.push("--list"),i},p=async(e,s)=>{const t=y(e,s);return await o("config",t)},d=async(e,s="local")=>{const{stdout:t}=await p(e,{get:!0,scope:s});if(t==="false")return!1;if(t==="true")return!0;const n=Number(t);return Number.isNaN(n)?t:n},b=async(e,s,t="local")=>await p(e,{scope:t,value:s}),x=(e,{delete:s=!1,remote:t="origin",signed:n=!1}={})=>{const c=[t,e];return s?[t,"-d",e]:(n!==!1&&c.push(`--signed=${n}`),c)},C=async(e,s={})=>{const t=x(e,s);return await o("push",t)},E=(e,{commit:s,delete:t=!1,message:n="",sign:c=!1}={})=>{if(t)return["-d",e];const a=[];return c&&a.push("-s"),a.push(e),s!==void 0&&a.push(s),[...a,"-m",`${n}`]},v=async(e,s={})=>{const t=E(e,s);return await o("tag",t)},T=e=>({value:e,enumerable:!0,configurable:!1,writable:!1}),N=(e,s)=>{Object.keys(s).forEach(t=>{const n=T(s[t]);Object.defineProperty(e,t,n)})};N(o,{commit:$,config:p,getConfig:d,setConfig:b,push:C,tag:v});const f=(e,s)=>s.split(".").reduce((t,n)=>t?.[n],e),R=async({allowEmptyCommit:e,commitMessage:s="",signCommit:t,signTag:n,tagMessage:c=""}={},a)=>{const i=[...s.matchAll(/{(.*?)}/g)].map(l=>l[1]);let r=s??"";i.forEach(l=>{const g=f(a,l);r=r.replace(`{${l}}`,`${g}`)});const m=[...c.matchAll(/{(.*?)}/g)].map(l=>l[1]);let u=c??"";m.forEach(l=>{const g=f(a,l);u=u.replace(`{${l}}`,`${g}`)}),await o.commit(r,{sign:t,allowEmpty:e}),await o.push(a.branch.name),await o.tag(a.nextRelease.gitTag,{delete:!0}),await o.tag(a.nextRelease.gitTag,{sign:n,message:u}),await o.push(a.nextRelease.gitTag,{delete:!0}),await o.push(a.nextRelease.gitTag)};exports.publish=R;
