"use strict";var $=require("execa");const c=async(s,e=[])=>await $.execa("git",[s,...e]),f=(s,{allowEmpty:e=!1,keyid:o,sign:l=!1}={})=>{const t=[];if(l){const n="-S",a=typeof o=="string"&&o!==""?`${n}${o}`:n;t.push(a)}return e&&t.push("--allow-empty"),[...t,"-m",`${s}`]},w=async(s,e={})=>{const o=f(s,e);return await c("commit",o)},y=(s,{get:e=!1,list:o=!1,unset:l=!1,scope:t="local",value:n}={})=>{const a=[`--${t}`];return n!=null?a.push(`${s}`,`${n.toString()}`):e?a.push("--get",`${s}`):l?a.push("--unset",`${s}`):o&&a.push("--list"),a},b=async(s,e={})=>{const o=y(s,e);return await c("config",o)},v=(s,{delete:e=!1,remote:o="origin",signed:l=!1}={})=>{const t=[o,s];return e?[o,"-d",s]:(l!==!1&&t.push(`--signed=${l}`),t)},x=async(s,e={})=>{const o=v(s,e);return await c("push",o)},E=(s,{commit:e,delete:o=!1,message:l="",sign:t=!1}={})=>{if(o)return["-d",s];const n=[];return t&&n.push("-s"),n.push(s),e!==void 0&&n.push(e),[...n,"-m",`${l}`]},S=async(s,e={})=>{const o=E(s,e);return await c("tag",o)},r=c,g=s=>({value:s,enumerable:!0,configurable:!1,writable:!1});Object.defineProperties(r,{commit:g(w),config:g(b),tag:g(S),push:g(x)});const j=({branch:s,nextRelease:e})=>({branch:s.name,version:e.version,tag:e.gitTag,notes:e.notes??""}),k=async(s={},e)=>{const{branch:o,version:l,tag:t,notes:n}=j(e);console.log("options:",s),console.log("branch:",o),console.log("version:",l),console.log("tag:",t),console.log("notes:",n),console.log("-------------- using git. delete local tag ----------");const a=await r.tag(t,{delete:!0});console.log("stderr:",a.stderr),console.log("stdout:",a.stdout),console.log("-------------- using git. delete remote tag ---------");const i=await r.push(t,{delete:!0});console.log("stderr:",i.stderr),console.log("stdout:",i.stdout);const u=`release: ${t}`;console.log("-------------- using git. commit release ------------");const d=await r.commit(`${u}

${n}`,{sign:!0,allowEmpty:!0});console.log("stderr:",d.stderr),console.log("stdout:",d.stdout),console.log("-------------- using git. tag release ---------------");const p=await r.tag(t,{sign:!0,message:`${u}

${n}`});console.log("stderr:",p.stderr),console.log("stdout:",p.stdout),console.log("-------------- using git. push commit release --------------");const m=await r.push(o);console.log("stderr:",m.stderr),console.log("stdout:",m.stdout),console.log("-------------- using git. push tag release --------------");const h=await r.push(t);console.log("stderr:",h.stderr),console.log("stdout:",h.stdout)};exports.publish=k;
